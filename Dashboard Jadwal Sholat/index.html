<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self'; 
        script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://unpkg.com; 
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; 
        font-src https://fonts.gstatic.com; 
        img-src 'self' data: https://images.unsplash.com https://www.transparenttextures.com; 
        connect-src 'self' https://api.aladhan.com https://api.open-meteo.com https://api.frankfurter.app;
    ">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">

    <title>Prayer Time Ultimate: 3D, Compass & Motivation</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        royal: { base: '#fdfbf7', gold: '#C5A059', dark: '#1a1816', surface: '#ffffff', accent: '#d4af37' }
                    },
                    fontFamily: {
                        display: ['Playfair Display', 'serif'],
                        body: ['Inter', 'sans-serif'],
                        arab: ['Amiri', 'serif']
                    },
                    boxShadow: {
                        'glass-thick': 'inset 1px 1px 0px 0px rgba(255, 255, 255, 0.7), inset -1px -1px 0px 0px rgba(0, 0, 0, 0.1), 0 10px 20px -5px rgba(0,0,0,0.15)',
                        'floating': '0 20px 40px -10px rgba(0,0,0,0.25)',
                        'inner-depth': 'inset 3px 3px 6px rgba(0,0,0,0.1), inset -3px -3px 6px rgba(255,255,255,0.8)',
                        'pop-out': '6px 6px 12px rgba(0,0,0,0.15), -6px -6px 12px rgba(255,255,255,0.9), inset 0 0 0 1px rgba(255,255,255,0.4)',
                        'neon-gold': '0 0 10px rgba(197, 160, 89, 0.5), 0 0 20px rgba(197, 160, 89, 0.3)'
                    },
                    dropShadow: { '3d': '0 4px 4px rgba(0,0,0,0.25)' }
                }
            }
        }
    </script>
    
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Inter:wght@300;400;500;600&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
<script>
  window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
</script>
<script defer src="/_vercel/insights/script.js"></script>
    <style>
        :root { --app-height: 100dvh; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e8e8e8;
            color: #2d2a26;
            height: var(--app-height);
            overflow: hidden; 
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        .bg-wallpaper {
            background-image: url('https://images.unsplash.com/photo-1519817914152-22d216bb9170?q=80&w=1000&auto=format&fit=crop'); 
            background-size: cover;
            background-position: center;
        }

        .glass-bevel {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border-top: 1px solid rgba(255, 255, 255, 0.9);
            border-left: 1px solid rgba(255, 255, 255, 0.9);
            border-right: 1px solid rgba(0, 0, 0, 0.1);
            border-bottom: 3px solid rgba(0, 0, 0, 0.15); 
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        .modal-glass-panel {
            background: linear-gradient(145deg, rgba(240, 240, 240, 0.9), rgba(255, 255, 255, 0.95));
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255,255,255,0.6);
            box-shadow: inset 1px 1px 0 rgba(255,255,255,0.8), 0 -10px 40px rgba(0,0,0,0.2);
        }

        .widget-inset {
            background: #e6e6e6;
            box-shadow: inset 5px 5px 10px rgba(0,0,0,0.1), inset -5px -5px 10px rgba(255,255,255,0.9);
            border-radius: 1.5rem;
            border: 1px solid rgba(0,0,0,0.02);
        }
        
        .widget-pop {
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            box-shadow: 5px 5px 10px rgba(0,0,0,0.1), -5px -5px 10px rgba(255,255,255,0.9);
            border-radius: 1.5rem;
        }

        .dock-shelf {
            background: rgba(30, 30, 30, 0.9);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255,255,255,0.2);
            border-bottom: 4px solid rgba(0,0,0,0.5); 
            box-shadow: 0 20px 50px rgba(0,0,0,0.4);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .tap-effect:active { 
            transform: scale(0.96) translateY(2px); 
            border-bottom-width: 0px;
            margin-top: 2px; 
            box-shadow: inset 0 4px 10px rgba(0,0,0,0.2);
            transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalUp { from { transform: translateY(110%); } to { transform: translateY(0); } }
        @keyframes shine { 0% { left: -100%; } 100% { left: 200%; } }
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 15px rgba(197, 160, 89, 0.3); } 50% { box-shadow: 0 0 25px rgba(197, 160, 89, 0.6); } }

        .animate-enter { animation: modalUp 0.6s cubic-bezier(0.19, 1, 0.22, 1) forwards; }
        
        .prayer-active-3d {
            background: linear-gradient(145deg, #2d2a26, #1a1816);
            color: #ffffff;
            border-top: 1px solid rgba(255,255,255,0.2);
            border-left: 1px solid rgba(255,255,255,0.2);
            border-bottom: 4px solid rgba(0,0,0,0.5);
            border-right: 1px solid rgba(0,0,0,0.5);
            transform: scale(1.02);
            z-index: 10;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        
        .prayer-inactive {
            background: rgba(255, 255, 255, 0.5);
            border-top: 1px solid rgba(255,255,255,0.8);
            border-bottom: 2px solid rgba(0,0,0,0.05);
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }
        
        .modal { 
            opacity: 0; visibility: hidden; transition: opacity 0.2s ease; 
            display: flex; align-items: flex-end; justify-content: center;
        }
        .modal.active { opacity: 1; visibility: visible; }
        .modal-content { 
            transform: translateY(100%); 
            transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            width: 100%; max-width: 500px;
            border-radius: 2.5rem 2.5rem 0 0;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .modal.active .modal-content { transform: translateY(0); }
        .text-emboss { text-shadow: 0 1px 0 rgba(255,255,255,0.4); }
        
        .compass-ring { transition: transform 0.1s cubic-bezier(0.2, 0, 0.2, 1); }
        .qibla-needle { transition: transform 0.3s ease-out; }
    </style>
</head>
<body class="bg-wallpaper flex flex-col items-center justify-center relative">

    <div class="absolute inset-0 bg-gradient-to-b from-white/40 via-transparent to-black/30 pointer-events-none"></div>
    <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/noise.png')] opacity-[0.03] pointer-events-none"></div>

    <main class="relative z-10 w-full h-full md:max-w-[460px] md:h-[95vh] md:rounded-[3rem] md:border-[10px] md:border-white/30 bg-white/10 backdrop-blur-sm flex flex-col overflow-hidden animate-enter shadow-2xl ring-1 ring-white/40">
        
        <header class="pt-8 pb-3 px-6 flex justify-between items-center shrink-0">
            <div class="flex-1 min-w-0">
                <p id="date-display" class="text-[10px] tracking-[0.25em] font-bold text-royal-dark/70 uppercase mb-1 drop-shadow-sm">...</p>
                <div class="relative group inline-block max-w-full">
                    <div class="flex items-center gap-2 cursor-pointer bg-white/70 px-4 py-2 rounded-2xl border-t border-l border-white shadow-pop-out active:shadow-inner-depth transition-all" id="loc-trigger">
                        <i data-lucide="map-pin" class="w-4 h-4 text-royal-dark shrink-0 fill-royal-gold/50"></i>
                        <h1 id="location-name" class="font-serif-title text-xl font-bold text-royal-dark truncate text-emboss">Mendeteksi...</h1>
                        <i data-lucide="chevron-down" class="w-4 h-4 text-gray-500 shrink-0"></i>
                    </div>
                    <select id="location-select" class="absolute top-0 left-0 w-full h-full opacity-0 cursor-pointer z-20"></select>
                </div>
            </div>
            <div id="clock-display" class="font-mono font-bold text-base text-royal-dark bg-[#f0f0f0] px-4 py-2 rounded-xl border-b-4 border-r border-gray-300 shadow-md shrink-0 ml-2 text-emboss">
                00:00
            </div>
        </header>

        <div class="px-6 py-2 shrink-0">
            <div class="glass-bevel rounded-[2.5rem] p-6 relative overflow-hidden group min-h-[220px] flex flex-col justify-center">
                <div class="absolute top-0 -left-[100%] w-[50%] h-full bg-gradient-to-r from-transparent via-white/40 to-transparent skew-x-12 animate-[shine_4s_infinite]"></div>
                
                <div class="absolute top-6 left-6 right-6 flex justify-between items-start z-20">
                    <span class="py-1.5 px-3 rounded-full bg-royal-gold text-white text-[9px] font-bold uppercase tracking-widest shadow-md">
                        Selanjutnya
                    </span>
                    <span id="hijri-date" class="text-[10px] font-bold text-royal-dark/70 font-arab bg-white/50 px-3 py-1.5 rounded-full border border-white/50 backdrop-blur-sm">...</span>
                </div>

                <div class="relative z-10 text-center flex flex-col items-center pt-10">
                    <h2 id="next-prayer-name" class="font-serif-title text-6xl md:text-[4.5rem] leading-none text-royal-dark font-medium mb-4 mt-2 tracking-tight drop-shadow-3d transition-all duration-300">...</h2>
                    
                    <div class="inline-block bg-[#e0e0e0] px-6 py-2 rounded-full border-t border-l border-gray-300 shadow-inner-depth mt-2">
                        <div id="countdown-timer" class="font-mono text-royal-dark text-sm font-bold tracking-widest text-emboss">
                            -- : -- : --
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex-1 overflow-y-auto no-scrollbar px-6 mt-4 pb-36 space-y-3" id="prayer-list">
        </div>

        <div class="absolute bottom-8 left-1/2 -translate-x-1/2 w-[90%] max-w-[400px] z-30">
            <div class="dock-shelf rounded-2xl p-2 flex justify-between items-end px-3">
                <button onclick="app.openModal('qiblat-modal')" class="tap-effect flex flex-col items-center gap-1 p-2 flex-1 rounded-xl mb-1 hover:bg-white/10 transition-colors">
                    <i data-lucide="compass" class="w-6 h-6 text-gray-400"></i>
                    <span class="text-[9px] font-bold text-gray-400">Kiblat</span>
                </button>
                <button onclick="app.openModal('date-modal')" class="tap-effect flex flex-col items-center gap-1 p-2 flex-1 rounded-xl mb-1 hover:bg-white/10 transition-colors">
                    <i data-lucide="calendar-search" class="w-6 h-6 text-gray-400"></i>
                    <span class="text-[9px] font-bold text-gray-400">Cari</span>
                </button>
                <div class="relative -top-8 mx-2 group">
                    <button onclick="app.openModal('quote-modal')" class="w-16 h-16 rounded-full bg-gradient-to-br from-[#d4af37] to-[#8a7024] flex items-center justify-center shadow-[0_10px_25px_rgba(212,175,55,0.5)] border-4 border-[#f0ebe5] transform transition-transform group-hover:scale-105 group-active:scale-95 animate-[pulse-glow_3s_infinite]">
                        <div class="absolute top-2 left-3 w-4 h-2 bg-white/40 rounded-full blur-[2px]"></div>
                        <i data-lucide="book-heart" class="w-7 h-7 text-white drop-shadow-md"></i>
                    </button>
                </div>
                <button onclick="app.openModal('weather-modal')" class="tap-effect flex flex-col items-center gap-1 p-2 flex-1 rounded-xl mb-1 hover:bg-white/10 transition-colors">
                    <i data-lucide="cloud-sun" class="w-6 h-6 text-gray-400"></i>
                    <span class="text-[9px] font-bold text-gray-400">Cuaca</span>
                </button>
                <button onclick="app.openModal('currency-modal')" class="tap-effect flex flex-col items-center gap-1 p-2 flex-1 rounded-xl mb-1 hover:bg-white/10 transition-colors">
                    <i data-lucide="banknote" class="w-6 h-6 text-gray-400"></i>
                    <span class="text-[9px] font-bold text-gray-400">Kurs</span>
                </button>
            </div>
        </div>
    </main>

    <div id="qiblat-modal" class="modal fixed inset-0 z-50 bg-royal-dark/60 backdrop-blur-md">
        <div class="modal-content modal-glass-panel p-8 relative text-center">
            <div class="w-16 h-1.5 bg-gray-300 rounded-full mx-auto mb-6 shadow-inner"></div>
            <div class="flex justify-between items-center mb-6">
                <div class="text-left">
                    <h3 class="font-serif-title text-2xl text-royal-dark font-bold text-emboss">Arah Kiblat</h3>
                    <p class="text-[10px] text-gray-500 font-bold uppercase tracking-widest mt-1" id="qiblat-status">Mode Kalkulasi</p>
                </div>
                <div class="bg-white/50 p-2 rounded-xl shadow-inner-depth"><i data-lucide="map" class="w-5 h-5 text-royal-gold"></i></div>
            </div>
            <div class="relative w-64 h-64 mx-auto mb-8 widget-pop flex items-center justify-center border-4 border-white/50">
                <div class="absolute inset-0 rounded-full shadow-inner-depth"></div>
                <div id="compass-dial" class="absolute inset-2 rounded-full border border-gray-200 compass-ring" style="background: url('https://www.transparenttextures.com/patterns/noise.png');">
                    <div class="absolute top-2 left-1/2 -translate-x-1/2 text-xs font-bold text-red-500">U</div>
                    <div class="absolute bottom-2 left-1/2 -translate-x-1/2 text-xs font-bold text-gray-400">S</div>
                    <div class="absolute right-2 top-1/2 -translate-y-1/2 text-xs font-bold text-gray-400">T</div>
                    <div class="absolute left-2 top-1/2 -translate-y-1/2 text-xs font-bold text-gray-400">B</div>
                </div>
                <div id="compass-arrow" class="w-full h-full flex items-center justify-center qibla-needle z-20">
                    <div class="w-2 h-28 bg-gradient-to-t from-royal-gold to-yellow-300 origin-bottom relative -translate-y-14 rounded-full shadow-[0_5px_15px_rgba(197,160,89,0.5)] border border-white/50">
                         <div class="absolute -top-5 left-1/2 -translate-x-1/2 bg-royal-dark p-2 rounded-full shadow-lg border-2 border-white">
                            <i data-lucide="kaaba" class="w-5 h-5 text-white fill-current"></i>
                         </div>
                    </div>
                </div>
            </div>
            <div class="flex items-center justify-center gap-4 mb-6">
                <div class="widget-inset px-6 py-2">
                    <div class="text-3xl font-mono font-bold text-royal-dark tracking-tighter text-emboss" id="qiblat-degree">--°</div>
                    <div class="text-[9px] text-gray-400 uppercase tracking-widest text-center">Sudut</div>
                </div>
            </div>
            <button onclick="app.startCompass()" id="btn-start-compass" class="w-full py-4 mb-3 bg-royal-dark text-white rounded-2xl border-b-4 border-black shadow-lg font-bold text-xs tap-effect flex justify-center items-center gap-2">
                <i data-lucide="compass" class="w-4 h-4"></i> Aktifkan Sensor Kompas
            </button>
            <button onclick="app.closeModal('qiblat-modal')" class="w-full py-4 bg-white/80 border-b-4 border-gray-200/50 shadow-sm rounded-2xl font-bold text-royal-dark tap-effect">Tutup</button>
        </div>
    </div>

    <div id="date-modal" class="modal fixed inset-0 z-50 bg-royal-dark/60 backdrop-blur-md">
        <div class="modal-content modal-glass-panel p-6 h-[75vh] flex flex-col">
            <div class="w-16 h-1.5 bg-gray-300 rounded-full mx-auto mb-6 shadow-inner"></div>
            <h3 class="font-serif-title text-2xl text-royal-dark font-bold mb-6 text-center text-emboss">Cari Jadwal</h3>
            <div class="widget-inset p-2 mb-6 shrink-0 flex items-center gap-2 bg-gray-100/80">
                <div class="p-2 bg-white rounded-xl shadow-sm"><i data-lucide="calendar" class="w-5 h-5 text-royal-gold"></i></div>
                <input type="date" id="search-date-input" class="w-full bg-transparent px-2 py-2 text-royal-dark font-bold focus:outline-none text-lg">
            </div>
            <div id="search-result-list" class="flex-1 overflow-y-auto no-scrollbar space-y-3 pb-4 px-1">
                <div class="flex flex-col items-center justify-center h-full text-gray-400/50">
                    <i data-lucide="calendar-range" class="w-16 h-16 mb-3"></i>
                    <p class="font-bold text-sm">Pilih Tanggal</p>
                </div>
            </div>
            <button onclick="app.closeModal('date-modal')" class="w-full py-4 bg-white/80 border-b-4 border-gray-200/50 shadow-sm rounded-2xl font-bold text-royal-dark tap-effect mt-2">Tutup</button>
        </div>
    </div>

    <div id="quote-modal" class="modal fixed inset-0 z-50 bg-royal-dark/60 backdrop-blur-md">
        <div class="modal-content modal-glass-panel p-8 text-center">
            <div class="w-16 h-1.5 bg-gray-300 rounded-full mx-auto mb-8 shadow-inner"></div>
            <div class="widget-pop p-8 relative mb-8 border border-white">
                <div class="absolute -top-6 left-1/2 -translate-x-1/2 w-12 h-12 bg-royal-gold rounded-full flex items-center justify-center shadow-lg border-4 border-[#f0f0f0]">
                    <i data-lucide="quote" class="w-5 h-5 text-white fill-white"></i>
                </div>
                <div class="mt-4 py-2">
                    <p id="quote-arab" class="font-arab text-3xl text-royal-dark mb-6 dir-rtl leading-[2.2] transition-opacity duration-300 drop-shadow-sm">...</p>
                    <div class="w-12 h-1 bg-gray-200 mx-auto rounded-full mb-6 shadow-inner"></div>
                    <p id="quote-arti" class="font-display italic text-gray-600 text-sm leading-relaxed transition-opacity duration-300">...</p>
                </div>
                <p id="quote-ref" class="text-[10px] font-bold text-royal-gold uppercase tracking-wide mt-6 border border-royal-gold/30 inline-block px-3 py-1 rounded-full bg-yellow-50">...</p>
            </div>
            <div class="flex gap-4">
                <button onclick="app.renderQuote()" class="flex-1 py-4 bg-royal-dark text-white rounded-2xl border-b-4 border-black shadow-lg font-bold text-xs tap-effect flex justify-center items-center gap-2">
                    <i data-lucide="refresh-cw" class="w-4 h-4"></i> Acak
                </button>
                <button onclick="app.closeModal('quote-modal')" class="flex-1 py-4 bg-white/80 border-b-4 border-gray-200/50 text-royal-dark rounded-2xl shadow-sm font-bold text-xs tap-effect">Tutup</button>
            </div>
        </div>
    </div>

    <div id="weather-modal" class="modal fixed inset-0 z-50 bg-royal-dark/60 backdrop-blur-md">
        <div class="modal-content modal-glass-panel p-6 text-center">
            <div class="w-16 h-1.5 bg-gray-300 rounded-full mx-auto mb-6 shadow-inner"></div>
            <div class="widget-pop p-6 mb-6 relative overflow-hidden border border-white group">
                <div class="absolute top-0 -left-[100%] w-[50%] h-full bg-gradient-to-r from-transparent via-white/40 to-transparent skew-x-12 animate-[shine_4s_infinite]"></div>
                <span id="weather-loc-name" class="inline-block text-[9px] font-bold uppercase tracking-widest text-white bg-royal-gold/90 px-3 py-1 rounded-full mb-4 shadow-md backdrop-blur-sm">Lokasi</span>
                <div class="flex flex-col items-center mb-2 relative z-10">
                    <i id="weather-icon-main" data-lucide="cloud" class="w-24 h-24 text-royal-dark mb-2 drop-shadow-xl fill-gray-200"></i>
                    <div class="font-serif-title text-7xl text-royal-dark tracking-tighter text-emboss drop-shadow-sm"><span id="weather-temp">--</span><span class="text-3xl align-top text-gray-400 pl-1">°</span></div>
                    <p id="weather-desc" class="text-xs text-gray-500 font-bold mt-2 uppercase tracking-wide bg-white/60 px-4 py-1.5 rounded-full shadow-inner-depth">--</p>
                </div>
            </div>
            <div class="grid grid-cols-3 gap-3 mb-6">
                <div class="p-3 widget-pop flex flex-col items-center border border-white">
                    <i data-lucide="thermometer" class="w-5 h-5 text-royal-gold mb-2"></i>
                    <span id="weather-feels" class="text-sm font-bold text-royal-dark">--</span>
                    <span class="text-[8px] text-gray-400 uppercase mt-1 font-bold">Terasa</span>
                </div>
                <div class="p-3 widget-pop flex flex-col items-center border border-white">
                    <i data-lucide="wind" class="w-5 h-5 text-royal-gold mb-2"></i>
                    <span id="weather-wind" class="text-sm font-bold text-royal-dark">--</span>
                    <span class="text-[8px] text-gray-400 uppercase mt-1 font-bold">Angin</span>
                </div>
                <div class="p-3 widget-pop flex flex-col items-center border border-white">
                    <i data-lucide="droplets" class="w-5 h-5 text-royal-gold mb-2"></i>
                    <span id="weather-rain" class="text-sm font-bold text-royal-dark">--</span>
                    <span class="text-[8px] text-gray-400 uppercase mt-1 font-bold">Hujan</span>
                </div>
            </div>
            <button onclick="app.closeModal('weather-modal')" class="w-full py-4 bg-white/80 border-b-4 border-gray-200/50 shadow-sm rounded-2xl font-bold text-royal-dark tap-effect">Tutup</button>
        </div>
    </div>

    <div id="currency-modal" class="modal fixed inset-0 z-50 bg-royal-dark/60 backdrop-blur-md">
        <div class="modal-content modal-glass-panel p-8">
            <div class="w-16 h-1.5 bg-gray-300 rounded-full mx-auto mb-8 shadow-inner"></div>
            <h3 class="font-serif-title text-2xl text-royal-dark font-bold mb-8 text-center text-emboss">Konversi Kurs</h3>
            <div class="space-y-6">
                <div class="widget-pop p-4 flex items-center gap-3 border border-white">
                    <input type="number" id="curr-amount" value="1" class="bg-transparent w-full font-bold text-royal-dark outline-none text-3xl placeholder-gray-300" placeholder="1">
                    <div class="w-[2px] h-8 bg-gray-200 shadow-inner"></div>
                    <select id="curr-from" class="bg-transparent font-bold text-royal-gold text-lg outline-none cursor-pointer pr-2">
                        <option value="USD">USD</option>
                        <option value="SAR">SAR</option>
                        <option value="EUR">EUR</option>
                        <option value="SGD">SGD</option>
                        <option value="MYR">MYR</option>
                        <option value="JPY">JPY</option>
                    </select>
                </div>
                <div class="flex justify-center -my-3 relative z-10">
                    <div class="bg-royal-gold text-white p-2 rounded-full shadow-lg border-2 border-white"><i data-lucide="arrow-down-up" class="w-5 h-5"></i></div>
                </div>
                <div class="bg-royal-dark p-6 rounded-[2rem] text-center text-white shadow-floating relative overflow-hidden border-t border-white/20 border-b-4 border-black">
                    <div class="absolute inset-0 bg-gradient-to-br from-white/10 to-transparent pointer-events-none"></div>
                    <span class="text-[10px] text-gray-400 uppercase tracking-widest block mb-2 relative z-10 font-bold">IDR (Rupiah Indonesia)</span>
                    <div id="curr-result" class="font-mono text-4xl font-bold relative z-10 text-emboss drop-shadow-md">Rp 0</div>
                </div>
            </div>
            <button onclick="app.closeModal('currency-modal')" class="w-full py-4 bg-white/80 border-b-4 border-gray-200/50 shadow-sm rounded-2xl font-bold text-royal-dark tap-effect mt-8">Tutup</button>
        </div>
    </div>

    <script>
    var app = (function() {
        
        // --- DATABASE LOKASI LENGKAP 500+ ---
        const cities = Object.freeze([
            // ACEH
            {name: "Aceh Barat (Meulaboh)", lat: 4.1415, lng: 96.1293}, {name: "Aceh Barat Daya", lat: 3.8185, lng: 96.8378}, {name: "Aceh Besar (Jantho)", lat: 5.2833, lng: 95.6167}, {name: "Aceh Jaya", lat: 4.6333, lng: 95.5833}, {name: "Aceh Selatan", lat: 3.2500, lng: 97.1833}, {name: "Aceh Singkil", lat: 2.3333, lng: 97.8333}, {name: "Aceh Tamiang", lat: 4.4167, lng: 98.0500}, {name: "Aceh Tengah", lat: 4.6333, lng: 96.8333}, {name: "Aceh Tenggara", lat: 3.4833, lng: 97.8000}, {name: "Aceh Timur", lat: 4.9667, lng: 97.7667}, {name: "Aceh Utara", lat: 5.0500, lng: 97.3167}, {name: "Banda Aceh", lat: 5.5483, lng: 95.3238}, {name: "Bener Meriah", lat: 4.7500, lng: 96.9167}, {name: "Bireuen", lat: 5.2012, lng: 96.7011}, {name: "Gayo Lues", lat: 3.9667, lng: 97.3500}, {name: "Langsa", lat: 4.4721, lng: 97.9737}, {name: "Lhokseumawe", lat: 5.1802, lng: 97.1507}, {name: "Nagan Raya", lat: 4.1667, lng: 96.3167}, {name: "Pidie", lat: 5.3833, lng: 95.9500}, {name: "Pidie Jaya", lat: 5.1500, lng: 96.2167}, {name: "Sabang", lat: 5.8950, lng: 95.3164}, {name: "Simeulue", lat: 2.6167, lng: 96.0833}, {name: "Subulussalam", lat: 2.6333, lng: 98.0000},
            // SUMUT
            {name: "Asahan", lat: 2.9833, lng: 99.6167}, {name: "Batubara", lat: 3.1667, lng: 99.5000}, {name: "Binjai", lat: 3.6000, lng: 98.4853}, {name: "Dairi", lat: 2.7500, lng: 98.3333}, {name: "Deli Serdang", lat: 3.5500, lng: 98.8667}, {name: "Gunung Sitoli", lat: 1.2833, lng: 97.6167}, {name: "Humbang Hasundutan", lat: 2.2500, lng: 98.7500}, {name: "Karo", lat: 3.1000, lng: 98.5000}, {name: "Labuhanbatu", lat: 2.1000, lng: 99.8333}, {name: "Labuhanbatu Selatan", lat: 1.9500, lng: 100.1000}, {name: "Labuhanbatu Utara", lat: 2.3333, lng: 99.6667}, {name: "Langkat", lat: 3.7500, lng: 98.2167}, {name: "Mandailing Natal", lat: 0.8667, lng: 99.5500}, {name: "Medan", lat: 3.5952, lng: 98.6722}, {name: "Nias", lat: 1.0500, lng: 97.7500}, {name: "Nias Barat", lat: 0.9500, lng: 97.4833}, {name: "Nias Selatan", lat: 0.6333, lng: 97.8500}, {name: "Nias Utara", lat: 1.3333, lng: 97.3167}, {name: "Padang Lawas", lat: 1.0500, lng: 99.7167}, {name: "Padang Lawas Utara", lat: 1.4500, lng: 99.6667}, {name: "Padang Sidempuan", lat: 1.3737, lng: 99.2674}, {name: "Pakpak Bharat", lat: 2.5667, lng: 98.2833}, {name: "Pematang Siantar", lat: 2.9649, lng: 99.0621}, {name: "Samosir", lat: 2.6167, lng: 98.7000}, {name: "Serdang Bedagai", lat: 3.5000, lng: 99.1167}, {name: "Sibolga", lat: 1.7397, lng: 98.7797}, {name: "Simalungun", lat: 2.9667, lng: 99.0000}, {name: "Tanjung Balai", lat: 2.9652, lng: 99.8003}, {name: "Tapanuli Selatan", lat: 1.5833, lng: 99.2500}, {name: "Tapanuli Tengah", lat: 1.6833, lng: 98.8333}, {name: "Tapanuli Utara", lat: 2.0167, lng: 98.9667}, {name: "Tebing Tinggi", lat: 3.3284, lng: 99.1625}, {name: "Toba Samosir", lat: 2.3333, lng: 99.0667},
            // SUMBAR
            {name: "Agam", lat: -0.3167, lng: 100.0333}, {name: "Bukittinggi", lat: -0.3039, lng: 100.3685}, {name: "Dharmasraya", lat: -0.9500, lng: 101.6333}, {name: "Kep. Mentawai", lat: -2.0000, lng: 99.5000}, {name: "Lima Puluh Kota", lat: -0.0667, lng: 100.5667}, {name: "Padang", lat: -0.9471, lng: 100.4172}, {name: "Padang Panjang", lat: -0.4667, lng: 100.4000}, {name: "Padang Pariaman", lat: -0.6333, lng: 100.1167}, {name: "Pariaman", lat: -0.6194, lng: 100.1217}, {name: "Pasaman", lat: 0.1500, lng: 100.1667}, {name: "Pasaman Barat", lat: 0.0833, lng: 99.8167}, {name: "Payakumbuh", lat: -0.2241, lng: 100.6323}, {name: "Pesisir Selatan", lat: -1.3500, lng: 100.5667}, {name: "Sawahlunto", lat: -0.6833, lng: 100.7833}, {name: "Sijunjung", lat: -0.6833, lng: 101.0000}, {name: "Solok (Kab)", lat: -0.9667, lng: 100.8333}, {name: "Solok (Kota)", lat: -0.8000, lng: 100.6500}, {name: "Solok Selatan", lat: -1.5000, lng: 101.1667}, {name: "Tanah Datar", lat: -0.4667, lng: 100.5833},
            // RIAU
            {name: "Bengkalis", lat: 1.4833, lng: 102.1000}, {name: "Dumai", lat: 1.6666, lng: 101.4453}, {name: "Indragiri Hilir", lat: -0.3167, lng: 103.1667}, {name: "Indragiri Hulu", lat: -0.3667, lng: 102.5500}, {name: "Kampar", lat: 0.3333, lng: 101.0333}, {name: "Kep. Meranti", lat: 1.0000, lng: 102.7000}, {name: "Kuantan Singingi", lat: -0.5333, lng: 101.5500}, {name: "Pekanbaru", lat: 0.5071, lng: 101.4478}, {name: "Pelalawan", lat: 0.2667, lng: 101.8667}, {name: "Rokan Hilir", lat: 2.1500, lng: 100.8167}, {name: "Rokan Hulu", lat: 0.8833, lng: 100.3167}, {name: "Siak", lat: 0.8000, lng: 102.0167},
            // KEPRI
            {name: "Batam", lat: 1.1455, lng: 104.0570}, {name: "Bintan", lat: 1.1500, lng: 104.5167}, {name: "Karimun", lat: 1.0500, lng: 103.4333}, {name: "Kep. Anambas", lat: 3.2500, lng: 106.2500}, {name: "Lingga", lat: -0.2000, lng: 104.6167}, {name: "Natuna", lat: 3.9500, lng: 108.2500}, {name: "Tanjung Pinang", lat: 0.9167, lng: 104.4500},
            // JAMBI
            {name: "Batanghari", lat: -1.7500, lng: 103.2500}, {name: "Bungo", lat: -1.4833, lng: 102.0000}, {name: "Jambi (Kota)", lat: -1.6101, lng: 103.6131}, {name: "Kerinci", lat: -2.0833, lng: 101.4667}, {name: "Merangin", lat: -2.0500, lng: 102.3000}, {name: "Muaro Jambi", lat: -1.5333, lng: 103.7500}, {name: "Sarolangun", lat: -2.3333, lng: 102.7333}, {name: "Sungai Penuh", lat: -2.0667, lng: 101.3833}, {name: "Tanjung Jabung Barat", lat: -0.9667, lng: 103.1667}, {name: "Tanjung Jabung Timur", lat: -1.1333, lng: 103.6167}, {name: "Tebo", lat: -1.3667, lng: 102.3333},
            // SUMSEL
            {name: "Banyuasin", lat: -2.8833, lng: 104.3833}, {name: "Empat Lawang", lat: -3.6667, lng: 102.9500}, {name: "Lahat", lat: -3.8000, lng: 103.5333}, {name: "Lubuklinggau", lat: -3.2952, lng: 102.8596}, {name: "Muara Enim", lat: -3.6500, lng: 103.7667}, {name: "Musi Banyuasin", lat: -2.9000, lng: 103.8500}, {name: "Musi Rawas", lat: -3.0833, lng: 103.2000}, {name: "Musi Rawas Utara", lat: -2.5000, lng: 103.0000}, {name: "Ogan Ilir", lat: -3.2333, lng: 104.6500}, {name: "Ogan Komering Ilir", lat: -3.3833, lng: 104.8167}, {name: "Ogan Komering Ulu", lat: -4.1278, lng: 104.1683}, {name: "OKU Selatan", lat: -4.6500, lng: 104.0000}, {name: "OKU Timur", lat: -4.0500, lng: 104.5833}, {name: "Pagar Alam", lat: -4.0157, lng: 103.2669}, {name: "Palembang", lat: -2.9761, lng: 104.7754}, {name: "PALI", lat: -3.2833, lng: 103.8667}, {name: "Prabumulih", lat: -3.4294, lng: 104.2295},
            // BABEL
            {name: "Bangka", lat: -1.8833, lng: 106.1167}, {name: "Bangka Barat", lat: -1.8500, lng: 105.4500}, {name: "Bangka Selatan", lat: -2.7000, lng: 106.3333}, {name: "Bangka Tengah", lat: -2.4167, lng: 106.1667}, {name: "Belitung", lat: -2.7500, lng: 107.6333}, {name: "Belitung Timur", lat: -2.9000, lng: 108.0500}, {name: "Pangkal Pinang", lat: -2.1324, lng: 106.1093},
            // BENGKULU
            {name: "Bengkulu (Kota)", lat: -3.8004, lng: 102.2655}, {name: "Bengkulu Selatan", lat: -4.3500, lng: 102.9167}, {name: "Bengkulu Tengah", lat: -3.7333, lng: 102.4333}, {name: "Bengkulu Utara", lat: -3.4167, lng: 102.0000}, {name: "Kaur", lat: -4.5833, lng: 103.4167}, {name: "Kepahiang", lat: -3.6500, lng: 102.5667}, {name: "Lebong", lat: -3.0500, lng: 102.2500}, {name: "Mukomuko", lat: -2.5833, lng: 101.1167}, {name: "Rejang Lebong", lat: -3.4667, lng: 102.5333}, {name: "Seluma", lat: -4.0167, lng: 102.6667},
            // LAMPUNG
            {name: "Bandar Lampung", lat: -5.3971, lng: 105.2668}, {name: "Lampung Barat", lat: -5.0333, lng: 104.0667}, {name: "Lampung Selatan", lat: -5.7167, lng: 105.6167}, {name: "Lampung Tengah", lat: -4.9500, lng: 105.2167}, {name: "Lampung Timur", lat: -5.1333, lng: 105.6833}, {name: "Lampung Utara", lat: -4.8167, lng: 104.8833}, {name: "Mesuji", lat: -3.9667, lng: 105.4167}, {name: "Metro", lat: -5.1136, lng: 105.3067}, {name: "Pesawaran", lat: -5.4167, lng: 105.1000}, {name: "Pesisir Barat", lat: -5.1833, lng: 103.9333}, {name: "Pringsewu", lat: -5.3500, lng: 104.9667}, {name: "Tanggamus", lat: -5.5000, lng: 104.6167}, {name: "Tulang Bawang", lat: -4.4667, lng: 105.2500}, {name: "Tulang Bawang Barat", lat: -4.4333, lng: 105.0500}, {name: "Way Kanan", lat: -4.6667, lng: 104.5333},
            // BANTEN
            {name: "Cilegon", lat: -6.0174, lng: 106.0538}, {name: "Lebak", lat: -6.6000, lng: 106.2500}, {name: "Pandeglang", lat: -6.3084, lng: 106.1067}, {name: "Serang (Kab)", lat: -6.0667, lng: 106.0500}, {name: "Serang (Kota)", lat: -6.1104, lng: 106.1639}, {name: "Tangerang (Kab)", lat: -6.2500, lng: 106.4667}, {name: "Tangerang (Kota)", lat: -6.1732, lng: 106.6300}, {name: "Tangerang Selatan", lat: -6.2886, lng: 106.7179},
            // DKI JAKARTA
            {name: "Jakarta Barat", lat: -6.1674, lng: 106.7637}, {name: "Jakarta Pusat", lat: -6.1805, lng: 106.8284}, {name: "Jakarta Selatan", lat: -6.2615, lng: 106.8106}, {name: "Jakarta Timur", lat: -6.2250, lng: 106.9004}, {name: "Jakarta Utara", lat: -6.1214, lng: 106.8827}, {name: "Kep. Seribu", lat: -5.6000, lng: 106.5500},
            // JABAR
            {name: "Bandung (Kab)", lat: -7.0167, lng: 107.5167}, {name: "Bandung (Kota)", lat: -6.9175, lng: 107.6191}, {name: "Bandung Barat", lat: -6.8333, lng: 107.5000}, {name: "Banjar", lat: -7.3667, lng: 108.5333}, {name: "Bekasi (Kab)", lat: -6.3500, lng: 107.1667}, {name: "Bekasi (Kota)", lat: -6.2383, lng: 106.9756}, {name: "Bogor (Kab)", lat: -6.4833, lng: 106.8500}, {name: "Bogor (Kota)", lat: -6.5971, lng: 106.8060}, {name: "Ciamis", lat: -7.3263, lng: 108.3537}, {name: "Cianjur", lat: -6.8206, lng: 107.1420}, {name: "Cimahi", lat: -6.8906, lng: 107.5456}, {name: "Cirebon (Kab)", lat: -6.7500, lng: 108.4833}, {name: "Cirebon (Kota)", lat: -6.7320, lng: 108.5523}, {name: "Depok", lat: -6.4025, lng: 106.7942}, {name: "Garut", lat: -7.2279, lng: 107.9087}, {name: "Indramayu", lat: -6.3264, lng: 108.3199}, {name: "Karawang", lat: -6.3042, lng: 107.3079}, {name: "Kuningan", lat: -6.9763, lng: 108.4831}, {name: "Majalengka", lat: -6.8358, lng: 108.2272}, {name: "Pangandaran", lat: -7.7000, lng: 108.6500}, {name: "Purwakarta", lat: -6.5561, lng: 107.4421}, {name: "Subang", lat: -6.5716, lng: 107.7587}, {name: "Sukabumi (Kab)", lat: -6.9833, lng: 106.5500}, {name: "Sukabumi (Kota)", lat: -6.9277, lng: 106.9300}, {name: "Sumedang", lat: -6.8586, lng: 107.9192}, {name: "Tasikmalaya (Kab)", lat: -7.3500, lng: 108.1000}, {name: "Tasikmalaya (Kota)", lat: -7.3274, lng: 108.2207},
            // JATENG
            {name: "Banjarnegara", lat: -7.3966, lng: 109.6964}, {name: "Banyumas", lat: -7.4245, lng: 109.2302}, {name: "Batang", lat: -6.9112, lng: 109.7317}, {name: "Blora", lat: -6.9698, lng: 111.4168}, {name: "Boyolali", lat: -7.5367, lng: 110.5958}, {name: "Brebes", lat: -6.8710, lng: 109.0435}, {name: "Cilacap", lat: -7.7279, lng: 109.0077}, {name: "Demak", lat: -6.8948, lng: 110.6385}, {name: "Grobogan", lat: -7.0833, lng: 110.9167}, {name: "Jepara", lat: -6.5835, lng: 110.6705}, {name: "Karanganyar", lat: -7.5960, lng: 110.9507}, {name: "Kebumen", lat: -7.6698, lng: 109.6517}, {name: "Kendal", lat: -6.9189, lng: 110.2016}, {name: "Klaten", lat: -7.7051, lng: 110.6015}, {name: "Kudus", lat: -6.8048, lng: 110.8405}, {name: "Magelang (Kab)", lat: -7.4333, lng: 110.1500}, {name: "Magelang (Kota)", lat: -7.4797, lng: 110.2177}, {name: "Pati", lat: -6.7550, lng: 111.0380}, {name: "Pekalongan (Kab)", lat: -7.0333, lng: 109.6167}, {name: "Pekalongan (Kota)", lat: -6.8898, lng: 109.6746}, {name: "Pemalang", lat: -6.8920, lng: 109.3813}, {name: "Purbalingga", lat: -7.3916, lng: 109.3622}, {name: "Purworejo", lat: -7.7167, lng: 110.0000}, {name: "Rembang", lat: -6.7167, lng: 111.3333}, {name: "Salatiga", lat: -7.3305, lng: 110.5084}, {name: "Semarang (Kab)", lat: -7.1333, lng: 110.4000}, {name: "Semarang (Kota)", lat: -6.9667, lng: 110.4167}, {name: "Solo (Surakarta)", lat: -7.5755, lng: 110.8243}, {name: "Sragen", lat: -7.4272, lng: 111.0223}, {name: "Sukoharjo", lat: -7.6833, lng: 110.8333}, {name: "Tegal (Kab)", lat: -6.9833, lng: 109.1333}, {name: "Tegal (Kota)", lat: -6.8694, lng: 109.1402}, {name: "Temanggung", lat: -7.3167, lng: 110.1667}, {name: "Wonogiri", lat: -7.8177, lng: 110.9262}, {name: "Wonosobo", lat: -7.3632, lng: 109.8998},
            // DIY
            {name: "Bantul", lat: -7.8833, lng: 110.3333}, {name: "Gunung Kidul", lat: -7.9667, lng: 110.6000}, {name: "Kulon Progo", lat: -7.8667, lng: 110.1500}, {name: "Sleman", lat: -7.7167, lng: 110.3500}, {name: "Yogyakarta (Kota)", lat: -7.7956, lng: 110.3695},
            // JATIM
            {name: "Bangkalan", lat: -7.0398, lng: 112.7423}, {name: "Banyuwangi", lat: -8.2192, lng: 114.3691}, {name: "Batu", lat: -7.8671, lng: 112.5239}, {name: "Blitar (Kab)", lat: -8.1333, lng: 112.2500}, {name: "Blitar (Kota)", lat: -8.0954, lng: 112.1610}, {name: "Bojonegoro", lat: -7.1502, lng: 111.8818}, {name: "Bondowoso", lat: -7.9135, lng: 113.8214}, {name: "Gresik", lat: -7.1596, lng: 112.6568}, {name: "Jember", lat: -8.1845, lng: 113.6681}, {name: "Jombang", lat: -7.5467, lng: 112.2333}, {name: "Kediri (Kab)", lat: -7.8167, lng: 112.1667}, {name: "Kediri (Kota)", lat: -7.8485, lng: 112.0178}, {name: "Lamongan", lat: -7.1197, lng: 112.4146}, {name: "Lumajang", lat: -8.1332, lng: 113.2226}, {name: "Madiun (Kab)", lat: -7.6167, lng: 111.6500}, {name: "Madiun (Kota)", lat: -7.6298, lng: 111.5177}, {name: "Magetan", lat: -7.6515, lng: 111.3323}, {name: "Malang (Kab)", lat: -8.1667, lng: 112.5667}, {name: "Malang (Kota)", lat: -7.9666, lng: 112.6326}, {name: "Mojokerto (Kab)", lat: -7.5500, lng: 112.5000}, {name: "Mojokerto (Kota)", lat: -7.4725, lng: 112.4340}, {name: "Nganjuk", lat: -7.6041, lng: 111.9009}, {name: "Ngawi", lat: -7.4038, lng: 111.4447}, {name: "Pacitan", lat: -8.2000, lng: 111.1000}, {name: "Pamekasan", lat: -7.1643, lng: 113.4866}, {name: "Pasuruan (Kab)", lat: -7.6667, lng: 112.8333}, {name: "Pasuruan (Kota)", lat: -7.6453, lng: 112.9075}, {name: "Ponorogo", lat: -7.8675, lng: 111.4627}, {name: "Probolinggo (Kab)", lat: -7.8667, lng: 113.3167}, {name: "Probolinggo (Kota)", lat: -7.7543, lng: 113.2159}, {name: "Sampang", lat: -7.1833, lng: 113.2500}, {name: "Sidoarjo", lat: -7.4478, lng: 112.7183}, {name: "Situbondo", lat: -7.7029, lng: 114.0044}, {name: "Sumenep", lat: -7.0167, lng: 113.8667}, {name: "Surabaya", lat: -7.2575, lng: 112.7521}, {name: "Trenggalek", lat: -8.0500, lng: 111.7167}, {name: "Tuban", lat: -6.8976, lng: 112.0638}, {name: "Tulungagung", lat: -8.0658, lng: 111.9016},
            // BALI
            {name: "Badung", lat: -8.5833, lng: 115.1667}, {name: "Bangli", lat: -8.4500, lng: 115.3500}, {name: "Buleleng", lat: -8.1167, lng: 115.0833}, {name: "Denpasar", lat: -8.6705, lng: 115.2126}, {name: "Gianyar", lat: -8.5435, lng: 115.3312}, {name: "Jembrana", lat: -8.3500, lng: 114.6333}, {name: "Karangasem", lat: -8.4000, lng: 115.5667}, {name: "Klungkung", lat: -8.5333, lng: 115.4000}, {name: "Tabanan", lat: -8.5528, lng: 115.1270},
            // NTB
            {name: "Bima (Kab)", lat: -8.4667, lng: 118.7333}, {name: "Bima (Kota)", lat: -8.4623, lng: 118.7297}, {name: "Dompu", lat: -8.5333, lng: 118.4667}, {name: "Lombok Barat", lat: -8.6833, lng: 116.1167}, {name: "Lombok Tengah", lat: -8.7000, lng: 116.2833}, {name: "Lombok Timur", lat: -8.6500, lng: 116.5333}, {name: "Lombok Utara", lat: -8.3500, lng: 116.1500}, {name: "Mataram", lat: -8.5833, lng: 116.1167}, {name: "Sumbawa", lat: -8.5000, lng: 117.4167}, {name: "Sumbawa Barat", lat: -8.7500, lng: 116.9167},
            // NTT
            {name: "Alor", lat: -8.2500, lng: 124.5000}, {name: "Belu", lat: -9.1000, lng: 124.8833}, {name: "Ende", lat: -8.8436, lng: 121.6624}, {name: "Flores Timur", lat: -8.3333, lng: 123.0000}, {name: "Kupang (Kab)", lat: -10.0333, lng: 123.8333}, {name: "Kupang (Kota)", lat: -10.1772, lng: 123.6070}, {name: "Lembata", lat: -8.4000, lng: 123.5000}, {name: "Malaka", lat: -9.5667, lng: 124.9000}, {name: "Manggarai", lat: -8.6000, lng: 120.4667}, {name: "Manggarai Barat", lat: -8.4908, lng: 119.8783}, {name: "Manggarai Timur", lat: -8.6000, lng: 120.6667}, {name: "Nagekeo", lat: -8.8333, lng: 121.3000}, {name: "Ngada", lat: -8.8000, lng: 121.0000}, {name: "Rote Ndao", lat: -10.7333, lng: 123.1000}, {name: "Sabu Raijua", lat: -10.5000, lng: 121.8333}, {name: "Sikka", lat: -8.6189, lng: 122.2111}, {name: "Sumba Barat", lat: -9.6333, lng: 119.4167}, {name: "Sumba Barat Daya", lat: -9.5667, lng: 119.1167}, {name: "Sumba Tengah", lat: -9.6167, lng: 119.6167}, {name: "Sumba Timur", lat: -9.6500, lng: 120.2667}, {name: "Timor Tengah Selatan", lat: -9.8667, lng: 124.2833}, {name: "Timor Tengah Utara", lat: -9.4500, lng: 124.4833},
            // KALBAR
            {name: "Bengkayang", lat: 0.8167, lng: 109.4833}, {name: "Kapuas Hulu", lat: 0.8333, lng: 112.9333}, {name: "Kayong Utara", lat: -1.0667, lng: 110.0000}, {name: "Ketapang", lat: -1.8500, lng: 109.9667}, {name: "Kubu Raya", lat: -0.2833, lng: 109.3333}, {name: "Landak", lat: 0.4167, lng: 109.7500}, {name: "Melawi", lat: -0.3333, lng: 111.7000}, {name: "Mempawah", lat: 0.3500, lng: 109.1667}, {name: "Pontianak", lat: -0.0263, lng: 109.3425}, {name: "Sambas", lat: 1.3333, lng: 109.2833}, {name: "Sanggau", lat: 0.1167, lng: 110.5833}, {name: "Sekadau", lat: 0.0333, lng: 110.9500}, {name: "Singkawang", lat: 0.9131, lng: 108.9877}, {name: "Sintang", lat: 0.0833, lng: 111.5000},
            // KALTENG
            {name: "Barito Selatan", lat: -1.8333, lng: 114.8333}, {name: "Barito Timur", lat: -2.0667, lng: 115.1667}, {name: "Barito Utara", lat: -0.9000, lng: 115.0833}, {name: "Gunung Mas", lat: -1.0000, lng: 113.8333}, {name: "Kapuas", lat: -3.0167, lng: 114.3833}, {name: "Katingan", lat: -1.9000, lng: 113.4000}, {name: "Kotawaringin Barat", lat: -2.4167, lng: 111.7500}, {name: "Kotawaringin Timur", lat: -2.5333, lng: 112.9500}, {name: "Lamandau", lat: -1.8333, lng: 111.2833}, {name: "Murung Raya", lat: -0.3000, lng: 114.2667}, {name: "Palangkaraya", lat: -2.2106, lng: 113.9144}, {name: "Pulang Pisau", lat: -2.7000, lng: 114.1667}, {name: "Seruyan", lat: -2.5000, lng: 112.5000}, {name: "Sukamara", lat: -2.6333, lng: 111.2333},
            // KALSEL
            {name: "Balangan", lat: -2.3333, lng: 115.5000}, {name: "Banjar", lat: -3.3167, lng: 115.0833}, {name: "Banjarbaru", lat: -3.4167, lng: 114.8333}, {name: "Banjarmasin", lat: -3.3194, lng: 114.5908}, {name: "Barito Kuala", lat: -3.0000, lng: 114.6667}, {name: "Hulu Sungai Selatan", lat: -2.7000, lng: 115.2000}, {name: "Hulu Sungai Tengah", lat: -2.6000, lng: 115.4167}, {name: "Hulu Sungai Utara", lat: -2.4167, lng: 115.1500}, {name: "Kotabaru", lat: -3.2333, lng: 116.1667}, {name: "Tabalong", lat: -1.9167, lng: 115.5000}, {name: "Tanah Bumbu", lat: -3.4500, lng: 116.0500}, {name: "Tanah Laut", lat: -3.8833, lng: 114.7667}, {name: "Tapin", lat: -2.9167, lng: 115.0333},
            // KALTIM
            {name: "Balikpapan", lat: -1.2379, lng: 116.8529}, {name: "Berau", lat: 2.1667, lng: 117.4167}, {name: "Bontang", lat: 0.1370, lng: 117.4967}, {name: "Kutai Barat", lat: -0.5833, lng: 115.5333}, {name: "Kutai Kartanegara", lat: -0.4167, lng: 116.9833}, {name: "Kutai Timur", lat: 0.9000, lng: 117.8333}, {name: "Mahakam Ulu", lat: 0.5000, lng: 115.0000}, {name: "Paser", lat: -1.8000, lng: 116.0333}, {name: "Penajam Paser Utara", lat: -1.2500, lng: 116.6667}, {name: "Samarinda", lat: -0.4949, lng: 117.1436},
            // KALTARA
            {name: "Bulungan", lat: 2.9167, lng: 117.2500}, {name: "Malinau", lat: 3.5833, lng: 116.6333}, {name: "Nunukan", lat: 4.1333, lng: 117.6500}, {name: "Tana Tidung", lat: 3.5500, lng: 117.2500}, {name: "Tarakan", lat: 3.3274, lng: 117.5746},
            // SULUT
            {name: "Bitung", lat: 1.4404, lng: 125.1217}, {name: "Bolaang Mongondow", lat: 0.7167, lng: 124.0333}, {name: "Bolmong Selatan", lat: 0.4000, lng: 123.7000}, {name: "Bolmong Timur", lat: 0.7333, lng: 124.4667}, {name: "Bolmong Utara", lat: 0.8833, lng: 123.3333}, {name: "Kep. Sangihe", lat: 3.5000, lng: 125.5000}, {name: "Siau Tagulandang Biaro", lat: 2.3333, lng: 125.4167}, {name: "Kep. Talaud", lat: 4.3333, lng: 126.8333}, {name: "Kotamobagu", lat: 0.7308, lng: 124.3197}, {name: "Manado", lat: 1.4748, lng: 124.8421}, {name: "Minahasa", lat: 1.1000, lng: 124.9167}, {name: "Minahasa Selatan", lat: 1.0333, lng: 124.5333}, {name: "Minahasa Tenggara", lat: 1.0167, lng: 124.7833}, {name: "Minahasa Utara", lat: 1.4167, lng: 124.9667}, {name: "Tomohon", lat: 1.3333, lng: 124.8333},
            // GORONTALO
            {name: "Boalemo", lat: 0.6333, lng: 122.3333}, {name: "Bone Bolango", lat: 0.5500, lng: 123.2333}, {name: "Gorontalo (Kab)", lat: 0.6333, lng: 122.9667}, {name: "Gorontalo (Kota)", lat: 0.5435, lng: 123.0568}, {name: "Gorontalo Utara", lat: 0.8000, lng: 122.8000}, {name: "Pohuwato", lat: 0.5000, lng: 121.8333},
            // SULTENG
            {name: "Banggai", lat: -1.2000, lng: 123.2000}, {name: "Banggai Kepulauan", lat: -1.6000, lng: 123.2500}, {name: "Banggai Laut", lat: -1.7500, lng: 123.5000}, {name: "Buol", lat: 1.0000, lng: 121.3333}, {name: "Donggala", lat: -0.5000, lng: 119.8333}, {name: "Morowali", lat: -2.3333, lng: 121.8333}, {name: "Morowali Utara", lat: -1.8333, lng: 121.3333}, {name: "Palu", lat: -0.9010, lng: 119.8398}, {name: "Parigi Moutong", lat: 0.5000, lng: 120.5000}, {name: "Poso", lat: -1.3957, lng: 120.7524}, {name: "Sigi", lat: -1.1000, lng: 119.9667}, {name: "Tojo Una-Una", lat: -1.1500, lng: 121.5000}, {name: "Toli-Toli", lat: 1.0333, lng: 120.8167},
            // SULBAR
            {name: "Majene", lat: -3.5167, lng: 118.9667}, {name: "Mamasa", lat: -2.9167, lng: 119.3667}, {name: "Mamuju", lat: -2.6687, lng: 118.8621}, {name: "Mamuju Tengah", lat: -2.0667, lng: 119.2500}, {name: "Pasangkayu", lat: -1.5833, lng: 119.4167}, {name: "Polewali Mandar", lat: -3.4167, lng: 119.3333},
            // SULSEL
            {name: "Bantaeng", lat: -5.5500, lng: 119.9500}, {name: "Barru", lat: -4.4167, lng: 119.6167}, {name: "Bone", lat: -4.5333, lng: 120.3167}, {name: "Bulukumba", lat: -5.5667, lng: 120.1833}, {name: "Enrekang", lat: -3.5500, lng: 119.7833}, {name: "Gowa", lat: -5.2167, lng: 119.4667}, {name: "Jeneponto", lat: -5.7000, lng: 119.7500}, {name: "Kep. Selayar", lat: -6.1000, lng: 120.4500}, {name: "Luwu", lat: -3.3500, lng: 120.3500}, {name: "Luwu Timur", lat: -2.5667, lng: 121.1667}, {name: "Luwu Utara", lat: -2.3333, lng: 120.2500}, {name: "Makassar", lat: -5.1477, lng: 119.4328}, {name: "Maros", lat: -5.0028, lng: 119.5717}, {name: "Palopo", lat: -2.9945, lng: 120.1970}, {name: "Pangkajene Kepulauan", lat: -4.8333, lng: 119.5500}, {name: "Parepare", lat: -4.0131, lng: 119.6243}, {name: "Pinrang", lat: -3.7833, lng: 119.6500}, {name: "Sidrap", lat: -3.9167, lng: 119.9333}, {name: "Sinjai", lat: -5.1333, lng: 120.2500}, {name: "Soppeng", lat: -4.3500, lng: 119.8833}, {name: "Takalar", lat: -5.4167, lng: 119.4500}, {name: "Tana Toraja", lat: -3.1000, lng: 119.8500}, {name: "Toraja Utara", lat: -2.9667, lng: 119.9000}, {name: "Wajo", lat: -4.1333, lng: 120.0333},
            // SULTRA
            {name: "Bau-Bau", lat: -5.4633, lng: 122.6015}, {name: "Bombana", lat: -4.7500, lng: 121.8333}, {name: "Buton", lat: -5.1333, lng: 122.9167}, {name: "Buton Selatan", lat: -5.6667, lng: 122.6667}, {name: "Buton Tengah", lat: -5.3333, lng: 122.3833}, {name: "Buton Utara", lat: -4.8333, lng: 123.1667}, {name: "Kolaka", lat: -4.0500, lng: 121.6000}, {name: "Kolaka Timur", lat: -4.2000, lng: 121.8000}, {name: "Kolaka Utara", lat: -3.3333, lng: 121.0667}, {name: "Konawe", lat: -3.8333, lng: 122.0833}, {name: "Konawe Kepulauan", lat: -4.1000, lng: 123.0833}, {name: "Konawe Selatan", lat: -4.1667, lng: 122.3333}, {name: "Konawe Utara", lat: -3.5000, lng: 122.0000}, {name: "Kendari", lat: -3.9973, lng: 122.5123}, {name: "Muna", lat: -4.8333, lng: 122.5000}, {name: "Muna Barat", lat: -4.8000, lng: 122.4000}, {name: "Wakatobi", lat: -5.3167, lng: 123.5833},
            // MALUKU
            {name: "Ambon", lat: -3.6954, lng: 128.1814}, {name: "Buru", lat: -3.2500, lng: 126.6667}, {name: "Buru Selatan", lat: -3.6667, lng: 126.8333}, {name: "Kep. Aru", lat: -6.1667, lng: 134.5000}, {name: "Maluku Barat Daya", lat: -8.0000, lng: 127.8333}, {name: "Maluku Tengah", lat: -3.3333, lng: 129.0000}, {name: "Maluku Tenggara", lat: -5.7500, lng: 132.7500}, {name: "Tanimbar", lat: -7.5000, lng: 131.5000}, {name: "Seram Bagian Barat", lat: -3.0833, lng: 128.5000}, {name: "Seram Bagian Timur", lat: -3.5000, lng: 130.5000}, {name: "Tual", lat: -5.6333, lng: 132.7500},
            // MALUT
            {name: "Halmahera Barat", lat: 1.1000, lng: 127.5000}, {name: "Halmahera Tengah", lat: 0.4167, lng: 128.0000}, {name: "Halmahera Timur", lat: 1.0000, lng: 128.5000}, {name: "Halmahera Selatan", lat: -0.6667, lng: 127.8333}, {name: "Halmahera Utara", lat: 1.5000, lng: 127.9167}, {name: "Kep. Sula", lat: -1.8667, lng: 126.0000}, {name: "Pulau Morotai", lat: 2.3333, lng: 128.5000}, {name: "Pulau Taliabu", lat: -1.8000, lng: 124.6000}, {name: "Ternate", lat: 0.7893, lng: 127.3630}, {name: "Tidore Kepulauan", lat: 0.6833, lng: 127.4000},
            // PAPUA
            {name: "Biak Numfor", lat: -1.1736, lng: 136.0820}, {name: "Jayapura (Kab)", lat: -2.9000, lng: 140.0000}, {name: "Jayapura (Kota)", lat: -2.5000, lng: 140.7167}, {name: "Keerom", lat: -3.3333, lng: 140.6667}, {name: "Kep. Yapen", lat: -1.7500, lng: 136.2500}, {name: "Mamberamo Raya", lat: -2.5000, lng: 137.8333}, {name: "Sarmi", lat: -2.2500, lng: 139.0833}, {name: "Supiori", lat: -0.7500, lng: 135.5833}, {name: "Waropen", lat: -2.6667, lng: 136.5833},
            // PAPUA BARAT
            {name: "Fakfak", lat: -2.9167, lng: 132.3000}, {name: "Kaimana", lat: -3.6500, lng: 133.7667}, {name: "Manokwari", lat: -0.8615, lng: 134.0620}, {name: "Manokwari Selatan", lat: -1.2500, lng: 134.0000}, {name: "Pegunungan Arfak", lat: -1.1667, lng: 133.8333}, {name: "Teluk Bintuni", lat: -2.1667, lng: 133.5000}, {name: "Teluk Wondama", lat: -2.7500, lng: 134.5000},
            // PAPUA SELATAN
            {name: "Asmat", lat: -5.8333, lng: 138.5000}, {name: "Boven Digoel", lat: -6.0833, lng: 140.4167}, {name: "Mappi", lat: -6.5000, lng: 139.5833}, {name: "Merauke", lat: -8.4991, lng: 140.4049},
            // PAPUA TENGAH
            {name: "Deiyai", lat: -4.0833, lng: 136.2500}, {name: "Dogiyai", lat: -3.9500, lng: 135.9167}, {name: "Intan Jaya", lat: -3.5833, lng: 137.0000}, {name: "Mimika (Timika)", lat: -4.5500, lng: 136.8833}, {name: "Nabire", lat: -3.3667, lng: 135.4833}, {name: "Paniai", lat: -3.8333, lng: 136.5000}, {name: "Puncak", lat: -3.6667, lng: 137.6667}, {name: "Puncak Jaya", lat: -3.7500, lng: 138.0000},
            // PAPUA PEGUNUNGAN
            {name: "Jayawijaya (Wamena)", lat: -4.0970, lng: 138.9388}, {name: "Lanny Jaya", lat: -3.9167, lng: 138.5000}, {name: "Mamberamo Tengah", lat: -3.6667, lng: 139.1667}, {name: "Nduga", lat: -4.4167, lng: 138.3333}, {name: "Pegunungan Bintang", lat: -4.6667, lng: 140.5000}, {name: "Tolikara", lat: -3.5000, lng: 138.5833}, {name: "Yahukimo", lat: -4.5000, lng: 139.5000}, {name: "Yalimo", lat: -3.8333, lng: 139.5000},
            // PAPUA BARAT DAYA
            {name: "Maybrat", lat: -1.3333, lng: 132.5000}, {name: "Raja Ampat", lat: -0.4333, lng: 130.8167}, {name: "Sorong (Kab)", lat: -1.0000, lng: 131.5000}, {name: "Sorong (Kota)", lat: -0.8767, lng: 131.2558}, {name: "Sorong Selatan", lat: -1.7500, lng: 132.0000}, {name: "Tambrauw", lat: -0.6667, lng: 132.5000}
        ]);

        const quotesDb = Object.freeze([
            // SHALAT & KESABARAN
            { arab: "وَاسْتَعِينُوا بِالصَّبْرِ وَالصَّلَاةِ", arti: "\"Dan jadikanlah sabar dan shalat sebagai penolongmu.\"", ref: "QS. Al-Baqarah: 45" },
            { arab: "إِنَّ اللَّهَ مَعَ الصَّابِرِينَ", arti: "\"Sesungguhnya Allah bersama orang-orang yang sabar.\"", ref: "QS. Al-Baqarah: 153" },
            { arab: "إِنَّ الصَّلَاةَ تَنْهَىٰ عَنِ الْفَحْشَاءِ وَالْمُنكَرِ", arti: "\"Sesungguhnya shalat itu mencegah dari (perbuatan-perbuatan) keji dan mungkar.\"", ref: "QS. Al-Ankabut: 45" },

            // REZEKI & JALAN KELUAR (STRATEGIS)
            { arab: "وَمَن يَتَّقِ اللَّهَ يَجْعَل لَّهُ مَخْرَجًا", arti: "\"Barangsiapa bertakwa kepada Allah niscaya Dia akan mengadakan baginya jalan keluar.\"", ref: "QS. At-Talaq: 2" },
            { arab: "وَيَرْزُقْهُ مِنْ حَيْثُ لَا يَحْتَسِبُ", arti: "\"Dan memberinya rezeki dari arah yang tiada disangka-sangkanya.\"", ref: "QS. At-Talaq: 3" },
            { arab: "لَئِن شَكَرْتُمْ لَأَزِيدَنَّكُمْ", arti: "\"Sesungguhnya jika kamu bersyukur, pasti Kami akan menambah (nikmat) kepadamu.\"", ref: "QS. Ibrahim: 7" },
            { arab: "فَإِذَا قُضِيَتِ الصَّلَاةُ فَانتَشِرُوا فِي الْأَرْضِ", arti: "\"Apabila telah ditunaikan shalat, maka bertebaranlah kamu di muka bumi (untuk mencari rezeki).\"", ref: "QS. Al-Jumu'ah: 10" },

            // KETENANGAN & HEALING (PSIKOLOGIS)
            { arab: "أَلَا بِذِكْرِ اللَّهِ تَطْمَئِنُّ الْقُلُوبُ", arti: "\"Ingatlah, hanya dengan mengingati Allah-lah hati menjadi tenteram.\"", ref: "QS. Ar-Ra'd: 28" },
            { arab: "فَإِنَّ مَعَ الْعُسْرِ يُسْرًا", arti: "\"Karena sesungguhnya sesudah kesulitan itu ada kemudahan.\"", ref: "QS. Al-Insyirah: 5" },
            { arab: "لَا يُكَلِّفُ اللَّهُ نَفْسًا إِلَّا وُسْعَهَا", arti: "\"Allah tidak membebani seseorang melainkan sesuai dengan kesanggupannya.\"", ref: "QS. Al-Baqarah: 286" },
            { arab: "لَا تَيْأَسُوا مِن رَّوْحِ اللَّهِ", arti: "\"Janganlah kamu berputus asa dari rahmat Allah.\"", ref: "QS. Yusuf: 87" },
            { arab: "لَا تَحْزَنْ إِنَّ اللَّهَ مَعَنَا", arti: "\"Janganlah kamu bersedih, sesungguhnya Allah bersama kita.\"", ref: "QS. At-Taubah: 40" },

            // KEPEMIMPINAN & OPTIMISME
            { arab: "وَلَا تَهِنُوا وَلَا تَحْزَنُوا وَأَنتُمُ الْأَعْلَوْنَ إِن كُنتُم مُّؤْمِنِينَ", arti: "\"Janganlah kamu bersikap lemah, dan janganlah (pula) kamu bersedih hati, padahal kamulah orang-orang yang paling tinggi (derajatnya), jika kamu orang-orang yang beriman.\"", ref: "QS. Ali Imran: 139" },
            { arab: "فَإِذَا عَزَمْتَ فَتَوَكَّلْ عَلَى اللَّهِ", arti: "\"Kemudian apabila kamu telah membulatkan tekad, maka bertawakkallah kepada Allah.\"", ref: "QS. Ali Imran: 159" },
            { arab: "إِنَّ خَيْرَ مَنِ اسْتَأْجَرْتَ الْقَوِيُّ الْأَمِينُ", arti: "\"Sesungguhnya orang yang paling baik yang kamu ambil untuk bekerja (pada kita) ialah orang yang kuat lagi dapat dipercaya.\"", ref: "QS. Al-Qasas: 26" },

            // HADITS PILIHAN (ETOS KERJA)
            { arab: "خَيْرُ الناسِ أَنفَعُهُم لِلنَّاسِ", arti: "\"Sebaik-baik manusia adalah yang paling bermanfaat bagi orang lain.\"", ref: "HR. Ahmad" },
            { arab: "إِنَّمَا الأَعْمَالُ بِالنِّيَّاتِ", arti: "\"Sesungguhnya setiap amal itu (tergantung) pada niatnya.\"", ref: "HR. Bukhari & Muslim" },
            { arab: "يَسِّرُوا وَلاَ تُعَسِّرُوا", arti: "\"Permudahlah dan jangan mempersulit.\"", ref: "HR. Bukhari" },
            { arab: "الْيَدُ الْعُلْيَا خَيْرٌ مِنَ الْيَدِ السُّفْلَى", arti: "\"Tangan yang di atas lebih baik daripada tangan yang di bawah.\"", ref: "HR. Bukhari" }
        ]);

        const els = {
            date: document.getElementById('date-display'),
            locName: document.getElementById('location-name'),
            locSelect: document.getElementById('location-select'),
            clock: document.getElementById('clock-display'),
            nextName: document.getElementById('next-prayer-name'),
            countdown: document.getElementById('countdown-timer'),
            hijri: document.getElementById('hijri-date'),
            list: document.getElementById('prayer-list'),
            qiblatDeg: document.getElementById('qiblat-degree'),
            compassArrow: document.getElementById('compass-arrow'),
            compassDial: document.getElementById('compass-dial'),
            qiblatStatus: document.getElementById('qiblat-status'),
            wTemp: document.getElementById('weather-temp'),
            wDesc: document.getElementById('weather-desc'),
            wIcon: document.getElementById('weather-icon-main'),
            wLoc: document.getElementById('weather-loc-name'),
            wWind: document.getElementById('weather-wind'),
            wRain: document.getElementById('weather-rain'),
            wFeels: document.getElementById('weather-feels'),
            qArab: document.getElementById('quote-arab'),
            qArti: document.getElementById('quote-arti'),
            qRef: document.getElementById('quote-ref'),
            cAmount: document.getElementById('curr-amount'),
            cFrom: document.getElementById('curr-from'),
            cRes: document.getElementById('curr-result'),
            sInput: document.getElementById('search-date-input'),
            sList: document.getElementById('search-result-list'),
            btnStartCompass: document.getElementById('btn-start-compass')
        };

        const sortedCities = [...cities].sort((a,b) => a.name.localeCompare(b.name));
        let currentLoc = sortedCities.find(c => c.name.includes("Jakarta Pusat")) || sortedCities[0];
        let prayerTimes = null;
        let qiblaAngle = 0;

        function init() {
            sortedCities.forEach(c => {
                let opt = document.createElement('option');
                opt.value = JSON.stringify(c);
                opt.text = c.name;
                if(c.name === currentLoc.name) opt.selected = true;
                els.locSelect.add(opt);
            });
            els.locSelect.addEventListener('change', (e) => updateLoc(JSON.parse(e.target.value)));
            els.cAmount.addEventListener('input', calcCurrency);
            els.cFrom.addEventListener('change', calcCurrency);
            els.sInput.addEventListener('change', searchDate);
            els.sInput.valueAsDate = new Date(); 

            updateClock();
            setInterval(updateClock, 1000);
            updateLoc(currentLoc);
        }

        function updateLoc(loc) {
            currentLoc = loc;
            els.locName.innerText = loc.name;
            fetchPrayer(loc.lat, loc.lng);
            els.wTemp.innerText = "--"; 
            calcQiblaStatic();
        }

        async function fetchPrayer(lat, lng) {
            try {
                const date = Math.floor(Date.now() / 1000);
                const res = await fetch(`https://api.aladhan.com/v1/timings/${date}?latitude=${lat}&longitude=${lng}&method=20`);
                const data = await res.json();
                if(data.data) {
                    prayerTimes = data.data.timings;
                    els.hijri.innerText = `${data.data.date.hijri.day} ${data.data.date.hijri.month.en}`;
                    calcNextPrayer(new Date());
                }
            } catch(e) {}
        }

        function updateClock() {
            const now = new Date();
            els.clock.innerText = now.toLocaleTimeString('id-ID', {hour:'2-digit', minute:'2-digit'});
            els.date.innerText = now.toLocaleDateString('id-ID', {weekday:'long', day:'numeric', month:'long'});
            if(prayerTimes) calcNextPrayer(now);
        }

        function calcNextPrayer(now) {
            if(!prayerTimes) return;
            const pNames = {Fajr:'Subuh', Sunrise:'Terbit', Dhuhr:'Dzuhur', Asr:'Ashar', Maghrib:'Maghrib', Isha:'Isya'};
            const timeToMin = t => { const[h,m]=t.split(':').map(Number); return h*60+m; };
            const nowMin = now.getHours()*60 + now.getMinutes();
            let next = null;
            let listHTML = '';
            const pList = ['Fajr', 'Sunrise', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'].map(k => {
                return { key: k, name: pNames[k], time: prayerTimes[k], min: timeToMin(prayerTimes[k]) };
            });

            if(now.getDay() === 5) {
                 const dz = pList.find(x=>x.key==='Dhuhr');
                 if(dz) dz.name = "Jumat";
            }

            for(let p of pList) {
                if(p.name === 'Terbit') continue; 
                if(p.min > nowMin) {
                    next = p;
                    const diffSec = (p.min * 60) - (now.getHours()*3600 + now.getMinutes()*60 + now.getSeconds());
                    const h = Math.floor(diffSec/3600).toString().padStart(2,'0');
                    const m = Math.floor((diffSec%3600)/60).toString().padStart(2,'0');
                    const s = (diffSec%60).toString().padStart(2,'0');
                    els.countdown.innerText = `- ${h}:${m}:${s}`;
                    break;
                }
            }

            if(!next) {
                next = { name: 'Subuh', time: prayerTimes.Fajr };
                els.countdown.innerText = "Istirahat";
            }
            els.nextName.innerText = next.name;

            pList.forEach((p) => {
                const active = (next.name === p.name);
                const isSun = p.name === 'Terbit';
                listHTML += `
                <div class="flex justify-between items-center px-6 py-4 rounded-2xl transition-all duration-300 ${active ? 'prayer-active-3d' : 'prayer-inactive'} ${isSun ? 'opacity-50' : ''}">
                    <div class="flex items-center gap-4">
                        ${active ? '<div class="w-3 h-3 rounded-full bg-royal-gold shadow-neon-gold border border-white"></div>' : (isSun ? '<i data-lucide="sun" class="w-4 h-4 text-gray-400"></i>' : '<div class="w-2 h-2 rounded-full bg-gray-300 shadow-inner"></div>')}
                        <span class="text-sm font-bold ${active ? 'text-white' : 'text-gray-600'} tracking-wide">${p.name}</span>
                    </div>
                    <span class="font-mono text-lg font-bold ${active ? 'text-white text-emboss' : 'text-royal-dark'}">${p.time}</span>
                </div>`;
            });
            els.list.innerHTML = listHTML;
            lucide.createIcons();
        }

        function calcQiblaStatic() {
            const lat1 = currentLoc.lat * (Math.PI/180);
            const lon1 = currentLoc.lng * (Math.PI/180);
            const lat2 = 21.422487 * (Math.PI/180); 
            const lon2 = 39.826206 * (Math.PI/180);
            const y = Math.sin(lon2-lon1) * Math.cos(lat2);
            const x = Math.cos(lat1)*Math.sin(lat2) - Math.sin(lat1)*Math.cos(lat2)*Math.cos(lon2-lon1);
            qiblaAngle = (Math.atan2(y, x) * 180 / Math.PI + 360) % 360;
            els.qiblatDeg.innerText = Math.round(qiblaAngle) + "°";
            els.compassArrow.style.transform = `rotate(${qiblaAngle}deg)`;
            els.compassDial.style.transform = `rotate(0deg)`;
            els.qiblatStatus.innerText = "Mode Kalkulasi (Statis)";
            els.qiblatStatus.classList.remove("text-green-600");
        }

        function startCompass() {
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission().then(response => {
                    if (response === 'granted') {
                        window.addEventListener('deviceorientation', handleOrientation, true);
                        uiCompassActive();
                    } else { alert("Izin ditolak."); }
                }).catch(console.error);
            } else if (window.DeviceOrientationEvent) {
                window.addEventListener('deviceorientationabsolute', handleOrientation, true);
                window.addEventListener('deviceorientation', handleOrientation, true);
                uiCompassActive();
            } else { alert("Perangkat tidak mendukung kompas."); }
        }

        function uiCompassActive() {
            els.btnStartCompass.style.display = 'none';
            els.qiblatStatus.innerText = "Mode Sensor Live (GPS Aktif)";
            els.qiblatStatus.classList.add("text-green-600");
        }

        function handleOrientation(event) {
            let alpha = null;
            if(event.webkitCompassHeading) alpha = event.webkitCompassHeading; 
            else if (event.absolute && event.alpha !== null) alpha = 360 - event.alpha;
            else if (event.alpha !== null) alpha = 360 - event.alpha; 
            if (alpha !== null) {
                els.compassDial.style.transform = `rotate(${-alpha}deg)`;
                els.compassArrow.style.transform = `rotate(${qiblaAngle - alpha}deg)`;
            }
        }

        function openModal(id) {
            document.getElementById(id).classList.add('active');
            if(id==='weather-modal') fetchWeather();
            if(id==='currency-modal') calcCurrency();
            if(id==='quote-modal') renderQuote();
        }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }

        function renderQuote() {
            els.qArab.style.opacity = 0;
            els.qArti.style.opacity = 0;
            setTimeout(() => {
                const r = quotesDb[Math.floor(Math.random() * quotesDb.length)];
                els.qArab.innerText = r.arab;
                els.qArti.innerText = r.arti;
                els.qRef.innerText = r.ref;
                els.qArab.style.opacity = 1;
                els.qArti.style.opacity = 1;
            }, 300);
        }

        async function searchDate() {
            const dVal = els.sInput.value;
            if(!dVal) return;
            const [y,m,d] = dVal.split('-');
            const dateStr = `${d}-${m}-${y}`;
            els.sList.innerHTML = '<div class="text-center text-xs p-4 text-gray-500">Memuat...</div>';
            try {
                const res = await fetch(`https://api.aladhan.com/v1/timings/${dateStr}?latitude=${currentLoc.lat}&longitude=${currentLoc.lng}&method=20`);
                const data = await res.json();
                const t = data.data.timings;
                const p = [{n:'Subuh', v:t.Fajr}, {n:'Terbit', v:t.Sunrise}, {n:'Dzuhur', v:t.Dhuhr}, {n:'Ashar', v:t.Asr}, {n:'Maghrib', v:t.Maghrib}, {n:'Isya', v:t.Isha}];
                let html = '';
                p.forEach(x => {
                    html += `<div class="flex justify-between items-center p-4 bg-white/50 shadow-sm border border-white rounded-2xl mb-2"><span class="text-sm font-bold text-gray-600">${x.n}</span><span class="text-lg font-mono font-bold text-royal-dark text-emboss">${x.v}</span></div>`;
                });
                els.sList.innerHTML = html;
            } catch(e) { els.sList.innerHTML = 'Gagal memuat data'; }
        }

        async function fetchWeather() {
            els.wLoc.innerText = currentLoc.name;
            try {
                const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${currentLoc.lat}&longitude=${currentLoc.lng}&current=temperature_2m,apparent_temperature,is_day,weather_code,wind_speed_10m&daily=precipitation_probability_max&timezone=auto`);
                const d = await res.json();
                if(d.current) {
                    els.wTemp.innerText = Math.round(d.current.temperature_2m);
                    els.wDesc.innerText = getWeatherCode(d.current.weather_code);
                    els.wIcon.setAttribute('data-lucide', getWeatherIcon(d.current.weather_code, d.current.is_day));
                    lucide.createIcons();
                    els.wFeels.innerText = Math.round(d.current.apparent_temperature) + "°";
                    els.wWind.innerText = d.current.wind_speed_10m + " km/h";
                    els.wRain.innerText = (d.daily.precipitation_probability_max?.[0] || 0) + "%";
                }
            } catch(e){ els.wDesc.innerText = "N/A"; }
        }

        function getWeatherCode(c) {
            if(c===0) return "Cerah"; if(c<=3) return "Berawan"; if(c===45 || c===48) return "Berkabut";
            if(c>=51 && c<=55) return "Gerimis"; if(c>=61 && c<=65) return "Hujan"; if(c>=80) return "Hujan Lebat";
            return "Mendung";
        }

        function getWeatherIcon(c, isDay) {
            if(c === 0) return isDay ? "sun" : "moon"; if(c <= 3) return isDay ? "cloud-sun" : "cloud-moon";
            if(c >= 51) return "cloud-drizzle"; if(c >= 80) return "cloud-lightning";
            return "cloud";
        }

        async function calcCurrency() {
            els.cRes.innerText = "...";
            try {
                const res = await fetch(`https://api.frankfurter.app/latest?amount=${els.cAmount.value}&from=${els.cFrom.value}&to=IDR`);
                const d = await res.json();
                els.cRes.innerText = "Rp " + d.rates.IDR.toLocaleString('id-ID', {maximumFractionDigits:0});
            } catch(e) { els.cRes.innerText = "Error"; }
        }

        init();
        return { openModal, closeModal, renderQuote, startCompass };
    })();
    </script>
</body>
</html>
